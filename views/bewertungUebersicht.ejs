<% pageTitle="Abgaben verwalten" %>

<div class="d-flex align-items-center justify-content-between mb-4">
    <h2 class="h4 m-0">Alle Abgaben und offene Challenges</h2>
    <span class="badge bg-info text-dark">
        Challenges: <%= abgaben.length %>
    </span>
</div>

<div class="row mb-4 g-2" id="filterContainer">
    
    <div class="col-md-6">
        <div class="input-group">
            <span class="input-group-text">Status:</span>
            <select class="form-select" id="statusFilter">
                <% statusOptions.forEach(opt => { %>
                    <option value="<%= opt %>" <%= activeStatus === opt ? 'selected' : '' %>>
                        <% 
                            let display = opt.charAt(0).toUpperCase() + opt.slice(1);
                            if (opt === 'offen') display = 'Noch nicht abgegeben';
                            if (opt === 'eingereicht') display = 'Zur Bewertung';
                            if (opt === 'alle') display = 'Alle Status';
                        %>
                        <%= display %>
                    </option>
                <% }) %>
            </select>
        </div>
    </div>

    <div class="col-md-6">
        <div class="input-group">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input type="text" id="bewertungSearch" class="form-control"
                placeholder="Suche nach Challenge oder Team..." value="<%= searchTerm %>" autocomplete="off">
        </div>
    </div>
</div>
<div class="table-responsive">
    </div>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        const statusFilter = document.getElementById('statusFilter');
        const searchInput = document.getElementById('bewertungSearch');
        const filterContainer = document.getElementById('filterContainer');

        let searchTimeout;

        function applyFilters() {
            // Holen Sie sich die aktuellen Werte
            const currentStatus = statusFilter.value;
            const currentSearch = searchInput.value.trim();

            // URL-Parameter vorbereiten
            const params = new URLSearchParams();
            
            if (currentStatus && currentStatus !== 'alle') {
                params.set('status', currentStatus);
            }
            if (currentSearch) {
                params.set('search', currentSearch);
            }
            
            // Zur neuen URL weiterleiten
            window.location.href = `/bewertung?${params.toString()}`;
        }

        // Event Listener für Status-Filter
        statusFilter.addEventListener('change', function () {
            applyFilters();
        });

        // Event Listener für Sucheingabe (mit Debounce)
        searchInput.addEventListener('input', function () {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                applyFilters();
            }, 500); // 500ms Verzögerung für effiziente Suche
        });
        
        // Initialen Search Term aus der URL setzen (falls vorhanden, wird aber durch EJS-Value gesetzt)
        // const urlParams = new URLSearchParams(window.location.search);
        // if (urlParams.get('search')) {
        //     searchInput.value = urlParams.get('search');
        // }
    });
</script>