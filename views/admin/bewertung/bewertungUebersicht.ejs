<% pageTitle = "Abgaben verwalten" %>

<div class="d-flex align-items-center justify-content-between mb-4">
  <h2 class="h4 m-0">Abgaben und Challenge-Status</h2>
</div>

<!-- Filter & Suche -->
<%- include('../../partials/filter_search', {
  showSchuljahr: false,
  showKategorie: false,
  showSearch: true,
  showStatus: true,

  statusOptions,
  activeStatus,
  statusFilterId: 'statusFilter',

  searchContainerId: 'searchContainer',
  searchInputId: 'bewertungSearch',
  searchTerm
}) %>

<div class="table-responsive">
  <table class="table table-hover align-middle table-light">
    <thead class="table-light">
      <tr>
        <th># Challenge ID</th>
        <th>Challenges (<%= abgaben.length %>)</th>
        <th>Team</th>
        <th>Status</th>
        <th>Eingereicht am</th>
        <th class="text-end min-width-actions">Aktionen</th>
      </tr>
    </thead>
    <tbody>

      <% if (abgaben.length === 0) { %>
        <tr>
          <td colspan="6" class="text-center py-4 text-muted">
            Keine Challenges gefunden.
          </td>
        </tr>
      <% } %>

      <% abgaben.forEach(abgabe => { %>
        <tr>
          <td class="text-muted small"><%= abgabe.challenge_id %></td>

          <td class="fw-medium"><%= abgabe.challenge_title %></td>

          <td><%= abgabe.team_name %></td>

          <!-- STATUS -->
          <td>
            <%
              let statusText = abgabe.status;
              if (abgabe.status === 'eingereicht') statusText = 'Zur Bewertung';
              if (abgabe.status === 'offen') statusText = 'Nicht abgegeben';
            %>

            <span class="status-badge status-<%= abgabe.status %>">
              <% if (abgabe.status === 'eingereicht') { %>
                <i class="bi bi-star me-1"></i>
              <% } else if (abgabe.status === 'bewertet') { %>
                <i class="bi bi-check-circle me-1"></i>
              <% } else if (abgabe.status === 'abgelehnt') { %>
                <i class="bi bi-x-circle me-1"></i>
              <% } else if (abgabe.status === 'entwurf') { %>
                <i class="bi bi-pencil me-1"></i>
              <% } else if (abgabe.status === 'offen') { %>
                <i class="bi bi-hourglass-split me-1"></i>
              <% } %>

              <%= statusText %>
            </span>
          </td>

          <!-- DATUM -->
          <td>
            <% if (abgabe.created_at) { %>
              <%= new Date(abgabe.created_at).toLocaleDateString('de-DE') %>
            <% } else { %>
              -
            <% } %>
          </td>

          <!-- AKTIONEN -->
          <td class="text-end">
            <% if (abgabe.id) { %>
              <a href="/bewertung/<%= abgabe.id %>" class="btn btn-outline-secondary btn-sm">
                <% if (abgabe.status === 'bewertet') { %>
                  Bewertung ansehen
                <% } else { %>
                  Bewerten
                <% } %>
              </a>
            <% } else { %>
              <span class="text-muted small">Wartet auf Abgabe</span>
            <% } %>
          </td>
        </tr>
      <% }) %>

    </tbody>
  </table>
</div>

<script src="/js/app/bewertungUebersichtLogic.js"></script>
