<% pageTitle = "Abgaben verwalten" %>

<div class="d-flex align-items-center justify-content-between mb-4">
  <h2 class="h4 m-0">Abgaben und Challenge-Status</h2>
  <span class="badge bg-info text-dark">
    Challenges: <%= abgaben.length %>
  </span>
</div>

<!-- Filter und Suchfunktion - Partial -->
<%- include('../../partials/filter_search', {
  showSchuljahr: false,
  showKategorie: false,
  showSearch: true,
  showStatus: true,

  // Status
  statusOptions,
  activeStatus,
  statusFilterId: 'statusFilter',

  // Suche
  searchContainerId: 'searchContainer',
  searchInputId: 'bewertungSearch',
  searchTerm
}) %>

<div class="table-responsive">
  <table class="table table-hover table align-middle m-0 table-light">
    <thead class="table-light">
      <tr>
        <th scope="col"># Challenge ID</th>
        <th scope="col">Challenge</th>
        <th scope="col">Team</th>
        <th scope="col">Status</th>
        <th scope="col">Eingereicht am</th>
        <th scope="col" class="text-end min-width-actions">Aktionen</th>
      </tr>
    </thead>
    <tbody>
      <% if (abgaben.length === 0) { %>
        <tr>
          <td colspan="6" class="text-center py-4 text-muted">
            Keine Challenges gefunden (Filter leert).
          </td>
        </tr>
      <% } %>

      <% abgaben.forEach(abgabe => { %>
        <tr>
          <td class="text-muted small"><%= abgabe.challenge_id %></td>
          <td class="fw-medium">
            <%= abgabe.challenge_title %>
          </td>
          <td>
            <%= abgabe.team_name %>
          </td>
          <td>
            <%
              let statusClass = 'secondary';
              let statusText = abgabe.status.charAt(0).toUpperCase() + abgabe.status.slice(1);

              if (abgabe.status === 'eingereicht') {
                statusClass = 'danger'; // Rot fÃ¼r "Zur Bewertung"
                statusText = 'Zur Bewertung';
              }
              if (abgabe.status === 'bewertet') statusClass = 'success';
              if (abgabe.status === 'abgelehnt') statusClass = 'dark';
              if (abgabe.status === 'entwurf') statusClass = 'warning text-dark';
              if (abgabe.status === 'offen') { // NEU: Wenn noch keine Abgabe erstellt
                statusClass = 'info text-dark';
                statusText = 'Nicht abgegeben';
              }
            %>
            <span class="badge bg-<%= statusClass %>">
              <%= statusText %>
            </span>
          </td>
          <td>
            <% if (abgabe.created_at) { %>
              <%= new Date(abgabe.created_at).toLocaleDateString('de-DE') %>
            <% } else { %>
              -
            <% } %>
          </td>
          <td class="text-end">
            <% if (abgabe.id) { %>
              <a href="/bewertung/<%= abgabe.id %>" class="btn btn-sm btn-custom-edit">
                <% if (abgabe.status === 'bewertet') { %>
                  Bewertung ansehen
                <% } else { %>
                  Bewerten
                <% } %>
              </a>
            <% } else { %>
              <span class="text-muted small">Wartet auf Abgabe</span>
            <% } %>
          </td>
        </tr>
      <% }); %>
    </tbody>
  </table>
</div>

<script src="/js/app/bewertungUebersichtLogic.js"></script>
