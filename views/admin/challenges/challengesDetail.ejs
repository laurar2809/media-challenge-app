<% pageTitle="Challenge Details" %>

  <a href="/challenges" class="btn btn-outline-secondary btn-sm px-3 mb-2">← Zurück zu Übersicht</a>
  <div class="card">
    <div class="card-header p-4 text-center bg-light border-0">
      <h2 class="h3 mb-3 fw-bold text-dark">
        <%= challenge.aufgabenpaket_title || 'Challenge' %>
      </h2>
      <div class="d-flex justify-content-center gap-1 flex-wrap mb-4">
        <span class="badge bg-secondary">
          <%= challenge.kategorie %>
        </span>
        <% if (challenge.abgabedatum) { %>
          <span class="badge bg-warning text-dark">
            <%= new Date(challenge.abgabedatum).toLocaleDateString('de-DE') %>
          </span>
          <% } %>
      </div>

      <% if (challenge.aufgabenpaket_icon) { %>
        <div class="challenge-image-container">
          <img src="<%= challenge.aufgabenpaket_icon %>" class="challenge-detail-image-full rounded shadow-sm"
            alt="<%= challenge.aufgabenpaket_title %>">
        </div>
        <% } else { %>
          <div class="challenge-image-container">
            <div class="challenge-main-placeholder rounded shadow-sm">
              <i class="bi bi-image display-4 opacity-25"></i>
            </div>
          </div>
          <% } %>
    </div>

  </div>


  <div class="card-body p-3">
    <div class="row g-2">
      <div class="col-md-8">
        <div class="mb-2">
          <small class="text-muted d-block mb-1">Team</small>
          <% if (challenge.team_name) { %>
            <div class="fw-medium">
              <%= challenge.team_name %>
            </div>
            <% if (challenge.team_mitglieder_names) { %>
              <small class="text-muted">
                <%= challenge.team_mitglieder_names %>
              </small>
              <% } %>
                <% } else { %>
                  <span class="text-muted">Kein Team</span>
                  <% } %>
        </div>

        <% if (challenge.aufgabenpaket_description) { %>
          <div class="mb-2">
            <small class="text-muted d-block mb-1">Beschreibung</small>
            <div class="lh-sm small">
              <%= challenge.aufgabenpaket_description %>
            </div>
          </div>
          <% } %>
      </div>

      <div class="col-md-4">
        <div class="d-flex flex-column h-100">
          <div class="flex-grow-1">
            <div class="mb-2">
              <small class="text-muted">Aufgabenpaket</small>
              <div>
                <%= challenge.aufgabenpaket_title || '-' %>
              </div>
            </div>
            <div class="mb-2">
              <small class="text-muted">Schuljahr</small>
              <div>
                <%= challenge.schuljahr_name || '-' %>
              </div>
            </div>
            <% if (challenge.zusatzinfos) { %>
              <div>
                <small class="text-muted">Zusatzinfos</small>
                <div class="text-truncate small" title="<%= challenge.zusatzinfos %>">
                  <%= challenge.zusatzinfos %>
                </div>
              </div>
              <% } %>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Buttons unten -->
<div class="card-footer bg-transparent p-3 border-0">
  <div class="d-flex gap-2 buttons-compact">
    <a href="/challenges/<%= challenge.id %>/edit" class="btn btn-custom-safe btn-sm px-3">Bearbeiten</a>
    <button type="button" class="btn btn-custom-delete btn-sm px-3" 
            data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
      Löschen
    </button>
  </div>
</div>


<%- include('../../partials/deleteModal', {
  modalId: 'confirmDeleteModal',
  formId: 'deleteConfirmForm',
  submitButtonId: 'confirmDeleteSubmit',
  title: 'Challenge löschen',
  bodyText: 'Bist du sicher, dass du diese Challenge löschen möchtest?',
  deleteUrl: `/challenges/${challenge.id}`  // ← Challenge-URL!
}) %>

</div>
