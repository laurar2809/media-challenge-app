<% pageTitle=title %>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

  <h1 class="h4 mb-3">
    <%= title %>
  </h1>
  <form action="<%= action %>" method="POST" id="challengeForm">


    <div class="row g-3">
      <div class="col-md-6">
        <div class="input-group mb-3">
          <span class="input-group-text">Aufgabenpaket *</span>
          <select name="aufgabenpaket_id" class="form-control" required>
            <option value="">Bitte w√§hlen...</option>
            <% aufgabenpakete.forEach(paket=> { %>
              <option value="<%= paket.id %>" <%=(Number(item.aufgabenpaket_id)===Number(paket.id)) ? 'selected' : '' %>
                >
                <%= paket.title %> (<%= paket.kategorie %>)
              </option>
              <% }) %>
          </select>
        </div>
      </div>

      <!--Schuljahr ausw√§hlen-->
      <div class="col-md-3">
        <div class="input-group mb-3">
          <span class="input-group-text">Schuljahr</span>
          <select name="schuljahr_id" class="form-control" required>
            <option value="">Schuljahr w√§hlen</option>
            <% schuljahre.forEach(jahr=> { %>
              <option value="<%= jahr.id %>" <%=(item.schuljahr_id==jahr.id) ? 'selected' : '' %>>
                <%= jahr.name %>
              </option>
              <% }) %>
          </select>
        </div>
      </div>


      <!-- Abgabedatum -->
      <div class="col-md-3">
        <div class="input-group mb-3">
          <span class="input-group-text" style="cursor: pointer;"
            onclick="document.getElementById('dateInput').showPicker()">
            <i class="bi bi-calendar"></i>
          </span>
          <input type="date" class="form-control custom-date-input" name="abgabedatum" id="dateInput"
            value="<%= item.abgabedatum ? new Date(item.abgabedatum).toISOString().split('T')[0] : '' %>">
        </div>
      </div>

      <!-- Zusatzinfos -->
      <div class="input-group mb-3 align-top-stretch">
        <span class="input-group-text">Challenge-Zusatzinformationen</span>
        <textarea name="zusatzinfos" class="form-control" rows="3"
          placeholder="Spezielle Anweisungen oder Hinweise f√ºr diese Challenge"><%= item.zusatzinfos || '' %></textarea>
      </div>
    </div>

    <!-- TEAM MANAGEMENT SECTION -->
    <h5 class="mb-3">Teams</h5>

    <!-- Aktuelle Teams -->
    <input type="hidden" id="existingTeamsData" value='<%= JSON.stringify(existingTeam || []) %>'>

    <div class="mb-3">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <label class="form-label mb-0">Aktuelle Teams</label>
        <button type="button" class="btn btn-custom-safe" data-bs-toggle="modal" data-bs-target="#teamModal">
          <i class="bi bi-plus-circle"></i> Neues Team erstellen
        </button>
      </div>
      <div id="teamsContainer">
        <!-- Teams werden hier dynamisch hinzugef√ºgt -->
      </div>
      <div id="noTeamsMessage" class="border rounded bg-light p-3 text-muted align-items-center w-100">
        <i class="bi bi-people me-2"></i>
        Noch keine Teams verf√ºgbar
      </div>
    </div>

    <!-- Team Erstellen Modal -->
    <div class="modal fade" id="teamModal" tabindex="-1" aria-labelledby="teamModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="teamModalLabel">Neues Team erstellen</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <!-- Team Name -->
            <div class="mb-2">
              <label class="form-label">Team Name *</label>
              <input type="text" class="form-control" id="newTeamName" placeholder="Team Name eingeben...">
            </div>


            <div class="row g-2 mb-2">
              <div class="col-md-4">
                <input type="text" class="form-control form-control-sm" id="nameFilter" placeholder="Namen suchen...">
              </div>
              <div class="col-md-2">
                <select class="form-select form-select-sm" id="classFilter">
                  <option value="">Alle Klassen</option>
                  <% const klassen=[...new Set(schueler.map(s=> s.klasse_name).filter(Boolean).sort())]; %>
                    <% klassen.forEach(klasse=> { %>
                      <option value="<%= klasse %>">
                        <%= klasse %>
                      </option>
                      <% }) %>
                </select>
              </div>

              <div class="col-md-3">
    <select class="form-select form-select-sm" id="teamSchuljahrFilter">
      <option value="">Alle Schuljahre</option>
      <% if (schuljahre && schuljahre.length) { %>
        <% schuljahre.forEach(schuljahr=> { %>
          <option value="<%= schuljahr.id %>">
            <%= schuljahr.name %>
          </option>
        <% }) %>
      <% } else { %>
        <% const schuljahrIds=[...new Set(schueler.map(s=> s.schuljahr_id).filter(Boolean).sort())]; %>
          <% schuljahrIds.forEach(id=> { %>
            <option value="<%= id %>">
              Schuljahr ID: <%= id %>
            </option>
          <% }) %>
      <% } %>
    </select>
  </div>
        

              <div class="col-md-2">
                <div class="form-check form-switch mt-1">
                  <input class="form-check-input" type="checkbox" id="onlyAvailableFilter">
                  <label class="form-check-label small" for="onlyAvailableFilter">Nur verf√ºgbare</label>
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Verf√ºgbare Teammitglieder</label>
              <div class="card">
                <div class="card-body p-3">
                  <p class="small text-muted mb-3 text-center" id="filterHint">
                    Verwenden Sie die Suchfilter oben, um Sch√ºler anzuzeigen
                  </p>
                  <div class="available-members-container border rounded p-2 bg-light"
                    style="max-height: 200px; overflow-y: auto; display: none;" id="availableMembersContainer">
                    <div class="d-flex flex-wrap gap-1" id="availableMembers">
                      <!-- Sch√ºler werden hier dynamisch eingef√ºgt -->
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Drop Zone f√ºr Team Mitglieder -->
            <div class="mb-3">
              <label class="form-label">Teammitglieder ausw√§hlen</label>
              <div class="drag-area border rounded p-3" id="teamDropZone"
                style="min-height: 100px; background-color: #f8f9fa; display: flex; flex-wrap: wrap; align-items: flex-start; gap: 5px; transition: all 0.3s;">
                <p class="text-muted text-center mb-0 w-100">Sch√ºler hierher ziehen oder klicken</p>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <small class="text-muted me-auto" id="memberCount">0 Mitglieder ausgew√§hlt</small>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
            <button type="button" class="btn btn-custom-safe" id="createTeamBtn" data-bs-dismiss="modal">
              <i class="bi bi-plus"></i> Team erstellen
            </button>
          </div>
        </div>
      </div>
    </div>

    </div>

    <!-- Versteckte Inputs f√ºr Formular -->
    <input type="hidden" name="teams_data" id="teamsData" value="">




    <button type="submit" class="btn btn-custom-safe">Challenge speichern</button>
    <a href="/challenges" class="btn btn-secondary">Abbrechen</a>

    <div id="schuelerData" style="display: none;" data-schueler='<%= JSON.stringify(schueler) %>'></div>
  </form>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    console.log('üöÄ formChallenges.ejs initialisiert');

    // === 1. DOM ELEMENTE DEFINIEREN ===
    const availableMembers = document.getElementById('availableMembers');
    const teamDropZone = document.getElementById('teamDropZone');
    const teamsContainer = document.getElementById('teamsContainer');
    const createTeamBtn = document.getElementById('createTeamBtn');
    const teamsDataInput = document.getElementById('teamsData');
    const newTeamName = document.getElementById('newTeamName');
    const nameFilter = document.getElementById('nameFilter');
    const classFilter = document.getElementById('classFilter');
    const dateInput = document.getElementById('dateInput');
    const filterHint = document.getElementById('filterHint');
    const onlyAvailableFilter = document.getElementById('onlyAvailableFilter');
    const teamSchuljahrFilter = document.getElementById('teamSchuljahrFilter');
    const challengeForm = document.getElementById('challengeForm');

    // === 2. DATEN LADEN ===
    // Sch√ºler-Daten
    const schuelerDataElement = document.getElementById('schuelerData');
    const schuelerListe = schuelerDataElement ? JSON.parse(schuelerDataElement.dataset.schueler) : [];
    console.log(`üìä ${schuelerListe.length} Sch√ºler geladen`);

    // Bestehende Teams
    const existingTeamsInput = document.getElementById('existingTeamsData');
    console.log('üì¶ Existing Teams Input:', existingTeamsInput ? existingTeamsInput.value : 'leer');

    // === 3. VARIABLEN ===
    let teams = [];
    let teamCounter = 1;
    let filterTimeout;

    // === 4. HELPER FUNCTIONS ===

    // HTML-Entities dekodieren
    function decodeHTML(str) {
      if (!str) return '';
      return str
        .replace(/&quot;/g, '"')
        .replace(/&#34;/g, '"')
        .replace(/&#39;/g, "'")
        .replace(/&amp;/g, '&')
        .replace(/&lt;/g, '<')
        .replace(/&gt;/g, '>');
    }

    // Teams Data f√ºr Formular aktualisieren
    function updateTeamsData() {
      if (teamsDataInput) {
        const teamsJSON = JSON.stringify(teams);
        teamsDataInput.value = teamsJSON;
        console.log(`üíæ Teams gespeichert: ${teams.length} Team(s)`, teams);
      }
    }

    // Member Counter aktualisieren
    function updateMemberCounter() {
      const members = teamDropZone.querySelectorAll('.drag-item[data-id]');
      const countElement = document.getElementById('memberCount');
      if (countElement) {
        const count = members.length;
        countElement.textContent = `${count} Mitglieder ausgew√§hlt`;
        countElement.className = count > 0 ? 'text-primary small fw-bold' : 'text-muted small';
      }
    }

    // Team Formular zur√ºcksetzen
    function clearTeamForm() {
      newTeamName.value = '';
      teamDropZone.innerHTML = '<p class="text-muted text-center mb-0 w-100">Sch√ºler hierher ziehen oder klicken</p>';
      updateMemberCounter();
      console.log('üßπ Team Formular zur√ºckgesetzt');
    }

    // Platzhalter aktualisieren
    function updatePlaceholder() {
      if (teamDropZone.children.length === 0) {
        const placeholder = document.createElement('p');
        placeholder.className = 'text-muted text-center mb-0 w-100';
        placeholder.textContent = 'Sch√ºler hierher ziehen oder klicken';
        teamDropZone.appendChild(placeholder);
      }
    }

    // Mitglied zur DropZone hinzuf√ºgen
    function addMemberToDropZone(memberElement) {
      const memberId = memberElement.dataset.id;
      const memberName = memberElement.textContent;

      // Pr√ºfen ob Mitglied bereits in DropZone
      if (!teamDropZone.querySelector(`[data-id="${memberId}"]`)) {
        console.log(`‚ûï F√ºge Mitglied hinzu: ${memberName}`);

        // Klone das Element
        const teamMember = document.createElement('button');
        teamMember.type = 'button';
        teamMember.className = 'btn btn-sm btn-custom-safe text-white me-1 mb-1';
        teamMember.innerHTML = `
          ${memberElement.dataset.vorname} ${memberElement.dataset.nachname} (${memberElement.dataset.klasse})
          <span class="ms-1" style="cursor: pointer; font-weight: bold;">√ó</span>
        `;
        teamMember.dataset.id = memberId;
        teamMember.dataset.vorname = memberElement.dataset.vorname;
        teamMember.dataset.nachname = memberElement.dataset.nachname;
        teamMember.dataset.klasse = memberElement.dataset.klasse;

        // Entfernen-Button
        teamMember.querySelector('span').addEventListener('click', function (e) {
          e.stopPropagation();
          console.log(`‚ûñ Entferne Mitglied: ${memberName}`);
          teamMember.remove();
          updatePlaceholder();
          updateMemberCounter();
          filterMembers(); // Filter neu anwenden
        });

        // Platzhalter entfernen
        const placeholder = teamDropZone.querySelector('p');
        if (placeholder) placeholder.remove();

        teamDropZone.appendChild(teamMember);
        updateMemberCounter();

        // In verf√ºgbarer Liste als ausgew√§hlt markieren
        memberElement.classList.add('opacity-50', 'disabled');
      }
    }

    // Teams rendern
    function renderTeams() {
      console.log(`üé® Rendere ${teams.length} Teams`);

      teamsContainer.innerHTML = '';
      const noTeamsMessage = document.getElementById('noTeamsMessage');

      if (teams.length > 0) {
        // Teams vorhanden - Nachricht ausblenden
        if (noTeamsMessage) {
          noTeamsMessage.style.display = 'none';
        }

        teams.forEach((team, index) => {
          const teamCard = document.createElement('div');
          teamCard.className = 'card mb-2';
          teamCard.innerHTML = `
            <div class="card-body p-3">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="card-title mb-0">
                  <i class="bi bi-people me-1"></i>${team.name}
                </h6>
                <button type="button" class="btn btn-sm btn-outline-danger remove-team" data-index="${index}">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
              <div class="mt-2">
                ${team.mitglieder.map(m =>
                  `<span class="badge bg-secondary me-1 mb-1">${m.vorname} ${m.nachname} (${m.klasse || ''})</span>`
                ).join('')}
              </div>
            </div>
          `;
          teamsContainer.appendChild(teamCard);
        });

        // Event Listener f√ºr Remove Buttons
        teamsContainer.querySelectorAll('.remove-team').forEach(btn => {
          btn.addEventListener('click', function () {
            const index = parseInt(this.dataset.index);
            const teamName = teams[index].name;
            if (confirm(`Team "${teamName}" wirklich l√∂schen?`)) {
              teams.splice(index, 1);
              renderTeams();
              updateTeamsData();
              filterMembers();
            }
          });
        });
      } else {
        // Keine Teams - Nachricht anzeigen
        if (noTeamsMessage) {
          noTeamsMessage.style.display = 'flex';
        }
        teamsContainer.innerHTML = '';
      }

      updateTeamsData();
      filterMembers();
    }

    // Filter-Funktion f√ºr Mitglieder
    function filterMembers() {
      const nameValue = nameFilter.value.toLowerCase().trim();
      const classValue = classFilter.value;
      const schuljahrValue = teamSchuljahrFilter ? teamSchuljahrFilter.value : '';
      const onlyAvailable = onlyAvailableFilter ? onlyAvailableFilter.checked : false;

      const availableMembersContainer = document.getElementById('availableMembersContainer');
      const availableMembers = document.getElementById('availableMembers');

      const hasActiveFilter = nameValue || classValue || schuljahrValue;

      if (hasActiveFilter) {
        availableMembersContainer.style.display = 'block';
        if (filterHint) filterHint.style.display = 'none';
      } else {
        availableMembersContainer.style.display = 'none';
        if (filterHint) filterHint.style.display = 'block';
        availableMembers.innerHTML = '';
        return;
      }

      availableMembers.innerHTML = '';
      let hasResults = false;

      schuelerListe.forEach(s => {
        const vorname = (s.vorname || '').toLowerCase();
        const nachname = (s.nachname || '').toLowerCase();
        const klasse = s.klasse_name || s.klasse || '';
        
        // Schuljahr extrahieren
        let schuljahr = '';
        if (s.schuljahr_name) {
          schuljahr = s.schuljahr_name.toLowerCase();
        } else if (s.schuljahr && typeof s.schuljahr === 'object') {
          schuljahr = (s.schuljahr.name || '').toLowerCase();
        } else if (s.schuljahr) {
          schuljahr = s.schuljahr.toString().toLowerCase();
        }
        
        const schuljahrId = s.schuljahr_id ? s.schuljahr_id.toString() : '';
        const memberId = s.id;

        // Pr√ºfen ob Mitglied bereits in einem Team ist
        const isInTeam = teams.some(team =>
          team.mitglieder.some(m => parseInt(m.id) === parseInt(memberId))
        );

        // Filter-Logik
        const nameMatch = !nameValue || vorname.includes(nameValue) || nachname.includes(nameValue);
        const classMatch = !classValue || klasse === classValue;
        const schuljahrMatch = !schuljahrValue || 
                              schuljahr.includes(schuljahrValue.toLowerCase()) || 
                              schuljahrId === schuljahrValue;
        const availableMatch = !onlyAvailable || !isInTeam;

        if (nameMatch && classMatch && schuljahrMatch && availableMatch) {
          hasResults = true;

          const memberElement = document.createElement('button');
          memberElement.type = 'button';
          memberElement.className = `btn btn-sm ${isInTeam ? 'btn-outline-secondary opacity-50 disabled' : 'btn-outline-primary'} me-1 mb-1 drag-item`;
          memberElement.dataset.id = memberId;
          memberElement.dataset.vorname = s.vorname;
          memberElement.dataset.nachname = s.nachname;
          memberElement.dataset.klasse = klasse;
          memberElement.dataset.schuljahr = schuljahr;
          memberElement.draggable = !isInTeam;
          memberElement.innerHTML = `
            ${s.vorname} ${s.nachname} 
            <span class="text-muted">(${klasse})</span>
          `;

          // Drag & Drop
          memberElement.addEventListener('dragstart', function (e) {
            if (!isInTeam) {
              e.dataTransfer.setData('text/plain', this.dataset.id);
              console.log(`üß≤ Starte Drag: ${this.textContent}`);
            }
          });

          // Click to add
          memberElement.addEventListener('click', function () {
            if (!isInTeam) {
              addMemberToDropZone(this);
            }
          });

          availableMembers.appendChild(memberElement);
        }
      });

      if (!hasResults) {
        availableMembers.innerHTML = `
          <div class="text-center text-muted py-4">
            <i class="bi bi-search display-6"></i>
            <p class="mt-2">Keine passenden Mitglieder gefunden</p>
          </div>
        `;
      }

      console.log(`üîç Filter angewendet: ${hasResults ? 'Ergebnisse gefunden' : 'Keine Ergebnisse'}`);
    }

    // === 5. EVENT LISTENER ===

    // Drag & Drop f√ºr Team DropZone
    teamDropZone.addEventListener('dragover', function (e) {
      e.preventDefault();
      this.style.backgroundColor = '#e9ecef';
      this.style.borderColor = '#007bff';
    });

    teamDropZone.addEventListener('dragleave', function (e) {
      e.preventDefault();
      this.style.backgroundColor = '#f8f9fa';
      this.style.borderColor = '#dee2e6';
    });

    teamDropZone.addEventListener('drop', function (e) {
      e.preventDefault();
      this.style.backgroundColor = '#f8f9fa';
      this.style.borderColor = '#dee2e6';
      
      const memberId = e.dataTransfer.getData('text/plain');
      if (memberId) {
        const memberElement = availableMembers.querySelector(`[data-id="${memberId}"]`);
        if (memberElement && !memberElement.classList.contains('disabled')) {
          addMemberToDropZone(memberElement);
        }
      }
    });

    // Klick auf leere DropZone √∂ffnet Modal
    teamDropZone.addEventListener('click', function (e) {
      if (e.target === this || e.target.tagName === 'P') {
        const modal = new bootstrap.Modal(document.getElementById('teamModal'));
        modal.show();
      }
    });

    // Team erstellen Button
    createTeamBtn.addEventListener('click', function () {
      const teamName = newTeamName.value.trim();
      const members = Array.from(teamDropZone.querySelectorAll('.btn[data-id]'));

      // Validierung
      if (!teamName) {
        alert('Bitte geben Sie einen Team Namen ein!');
        newTeamName.focus();
        return;
      }

      if (members.length === 0) {
        alert('Bitte f√ºgen Sie mindestens ein Teammitglied hinzu!');
        return;
      }

      // Team-Objekt erstellen
      const isEditMode = window.location.pathname.includes('/edit');
      const teamId = isEditMode 
        ? `new-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`
        : `team-${teamCounter++}`;

      const team = {
        id: teamId,
        name: teamName,
        mitglieder: members.map(member => ({
          id: parseInt(member.dataset.id),
          vorname: member.dataset.vorname,
          nachname: member.dataset.nachname,
          klasse: member.dataset.klasse
        }))
      };

      teams.push(team);
      console.log(`‚úÖ Team erstellt: "${teamName}" mit ${members.length} Mitgliedern`);

      // Modal schlie√üen und zur√ºcksetzen
      const modal = bootstrap.Modal.getInstance(document.getElementById('teamModal'));
      if (modal) modal.hide();

      renderTeams();
      clearTeamForm();
    });

    // Filter Event Listener
    function setupFilterListeners() {
      const filterElements = [nameFilter, classFilter, teamSchuljahrFilter, onlyAvailableFilter];
      
      filterElements.forEach(element => {
        if (element) {
          element.addEventListener('input', handleFilterChange);
          element.addEventListener('change', handleFilterChange);
        }
      });
    }

    function handleFilterChange() {
      clearTimeout(filterTimeout);
      filterTimeout = setTimeout(() => {
        console.log('üîÑ Filter aktualisiert');
        filterMembers();
      }, 300);
    }

    // Formular Submit
    challengeForm.addEventListener('submit', function (e) {
      // Nur validieren, NICHT abbrechen!
      if (teams.length === 0) {
        e.preventDefault();
        alert('‚ùå Bitte erstellen Sie mindestens ein Team f√ºr diese Challenge!');
        return false;
      }
      
      // Teams-Daten validieren
      const hasEmptyTeams = teams.some(team => !team.mitglieder || team.mitglieder.length === 0);
      if (hasEmptyTeams) {
        e.preventDefault();
        alert('‚ùå Ein Team hat keine Mitglieder! Bitte √ºberpr√ºfen Sie alle Teams.');
        return false;
      }
      
      console.log(`‚úÖ Formular wird gesendet mit ${teams.length} Teams`);
      return true;
    });

    // Modal Events
    const teamModal = document.getElementById('teamModal');
    if (teamModal) {
      teamModal.addEventListener('show.bs.modal', function () {
        console.log('üìã Modal ge√∂ffnet');
        clearTeamForm();
        if (nameFilter) nameFilter.value = '';
        if (classFilter) classFilter.value = '';
        if (teamSchuljahrFilter) teamSchuljahrFilter.value = '';
        if (onlyAvailableFilter) onlyAvailableFilter.checked = false;
        filterMembers();
      });

      teamModal.addEventListener('hidden.bs.modal', function () {
        console.log('üìã Modal geschlossen');
        // Optional: Filter zur√ºcksetzen
      });
    }

    // Date Input Picker
    if (dateInput) {
      dateInput.addEventListener('click', function () {
        this.showPicker();
      });
    }

    // === 6. INITIALISIERUNG ===
    function initialize() {
      console.log('‚öôÔ∏è Initialisiere formChallenges...');
      
      // 1. Bestehende Teams laden
      try {
        if (existingTeamsInput && existingTeamsInput.value) {
          const rawValue = existingTeamsInput.value;
          console.log('Raw teams data:', rawValue);
          
          if (rawValue && rawValue !== '[]' && rawValue !== '""') {
            const decodedValue = decodeHTML(rawValue);
            teams = JSON.parse(decodedValue);
            teamCounter = teams.length + 1;
            console.log(`üì¶ ${teams.length} bestehende Teams geladen:`, teams);
          }
        }
      } catch (error) {
        console.error('‚ùå Fehler beim Laden der Teams:', error);
        teams = [];
      }
      
      // 2. Teams rendern
      renderTeams();
      
      // 3. Filter Listener setup
      setupFilterListeners();
      
      // 4. Initial Filter anwenden
      filterMembers();
      
      // 5. Platzhalter setzen
      updatePlaceholder();
      updateMemberCounter();
      
      console.log('‚úÖ formChallenges erfolgreich initialisiert');
    }

    // Starte Initialisierung
    initialize();

    // === 7. DEBUG HELPER ===
    window.debugTeams = function() {
      console.log('=== DEBUG TEAMS ===');
      console.log('Teams Array:', teams);
      console.log('Teams Data Input:', teamsDataInput.value);
      console.log('Sch√ºler Liste:', schuelerListe.length, 'Eintr√§ge');
      console.log('Filter Status:', {
        name: nameFilter.value,
        class: classFilter.value,
        schuljahr: teamSchuljahrFilter.value,
        onlyAvailable: onlyAvailableFilter.checked
      });
    };

    // Global verf√ºgbar f√ºr Debugging
    window.teams = teams;
    window.schuelerListe = schuelerListe;
  });
</script>