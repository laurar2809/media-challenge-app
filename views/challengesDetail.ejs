<% pageTitle="Challenge Details" %>

<div class="d-flex align-items-center justify-content-between mb-4">
  <h1 class="h3 m-0">Challenge Details</h1>
  <div>
    <a href="/challenges/<%= challenge.id %>/edit" class="btn btn-outline-secondary btn-sm">Bearbeiten</a>
    <a href="/challenges" class="btn btn-secondary btn-sm">Zurück zur Übersicht</a>
  </div>
</div>

<div class="row">
  <!-- Hauptinformationen -->
  <div class="col-lg-8">
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">
        <h5 class="card-title mb-0">Challenge Informationen</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <!-- Aufgabenpaket -->
          <div class="col-md-6 mb-3">
            <strong class="d-block text-muted small">Aufgabenpaket:</strong>
            <span class="fs-5"><%= challenge.aufgabenpaket_title || 'Nicht zugewiesen' %></span>
          </div>

          <!-- Kategorie -->
          <div class="col-md-6 mb-3">
            <strong class="d-block text-muted small">Kategorie:</strong>
            <span class="badge bg-secondary fs-6"><%= challenge.kategorie %></span>
          </div>

          <!-- Abgabedatum -->
          <div class="col-md-6 mb-3">
            <strong class="d-block text-muted small">Abgabedatum:</strong>
            <span class="fs-6">
              <% if (challenge.abgabedatum) { %>
                <%= new Date(challenge.abgabedatum).toLocaleDateString('de-DE') %>
              <% } else { %>
                <span class="text-muted">Nicht festgelegt</span>
              <% } %>
            </span>
          </div>

          <!-- Schuljahr -->
          <div class="col-md-6 mb-3">
            <strong class="d-block text-muted small">Schuljahr:</strong>
            <span class="fs-6"><%= challenge.schuljahr_name || 'Nicht zugewiesen' %></span>
          </div>
        </div>

        <!-- Zusatzinfos -->
        <% if (challenge.zusatzinfos) { %>
          <div class="mt-3">
            <strong class="d-block text-muted small">Zusatzinformationen:</strong>
            <p class="mt-1 p-3 bg-light rounded"><%= challenge.zusatzinfos %></p>
          </div>
        <% } %>
      </div>
    </div>

    <!-- Aufgabenpaket Details -->
    <div class="card mb-4">
      <div class="card-header bg-info text-white">
        <h5 class="card-title mb-0">Aufgabenpaket Details</h5>
      </div>
      <div class="card-body">
        <% if (challenge.aufgabenpaket_description) { %>
          <strong class="d-block text-muted small mb-2">Beschreibung:</strong>
          <p><%= challenge.aufgabenpaket_description %></p>
        <% } else { %>
          <p class="text-muted">Keine Beschreibung verfügbar</p>
        <% } %>
      </div>
    </div>
  </div>

  <!-- Sidebar mit Team und Bild -->
  <div class="col-lg-4">
    <!-- Bild vom Aufgabenpaket -->
    <div class="card mb-4">
      <div class="card-header bg-success text-white">
        <h5 class="card-title mb-0">Aufgabenpaket Bild</h5>
      </div>
      <div class="card-body text-center">
        <% if (challenge.aufgabenpaket_icon) { %>
          <img src="<%= challenge.aufgabenpaket_icon %>" 
               class="img-fluid rounded" 
               alt="<%= challenge.aufgabenpaket_title %>"
               style="max-height: 250px; object-fit: cover;">
          <p class="text-muted small mt-2">Bild vom Aufgabenpaket</p>
        <% } else { %>
          <div class="bg-light rounded d-flex align-items-center justify-content-center" 
               style="height: 200px;">
            <span class="text-muted">Kein Bild verfügbar</span>
          </div>
        <% } %>
      </div>
    </div>

    <!-- Team Informationen -->
<div class="card">
  <div class="card-header bg-warning text-dark">
    <h5 class="card-title mb-0">Team Informationen</h5>
  </div>
  <div class="card-body">
    <% if (challenge.team_name) { %>
      <div class="mb-3">
        <strong class="d-block text-muted small">Team Name:</strong>
        <span class="fw-bold text-primary"><%= challenge.team_name %></span>
      </div>

      <!-- TEAM-BESCHREIBUNG ENTFERNEN ODER AUSKOMMENTIEREN -->
      <% if (false && challenge.team_beschreibung) { %>
        <div class="mb-3">
          <strong class="d-block text-muted small">Team Beschreibung:</strong>
          <p class="small"><%= challenge.team_beschreibung %></p>
        </div>
      <% } %>

      <div class="mb-3">
        <strong class="d-block text-muted small">Teammitglieder:</strong>
        <ul class="list-unstyled mt-1">
          <% if (challenge.team_mitglieder_names) { %>
            <% challenge.team_mitglieder_names.split(', ').forEach(mitglied => { %>
              <li class="py-1 border-bottom">
                <i class="fas fa-user me-2 text-muted"></i>
                <%= mitglied %>
              </li>
            <% }) %>
          <% } else { %>
            <li class="text-muted">Keine Teammitglieder</li>
          <% } %>
        </ul>
      </div>
    <% } else { %>
      <p class="text-muted">Kein Team zugewiesen</p>
    <% } %>
  </div>
</div>

<!-- Metadaten -->
<div class="card mt-4">
  <div class="card-header bg-light">
    <h5 class="card-title mb-0">Metadaten</h5>
  </div>
  <div class="card-body">
    <div class="row">
      <div class="col-md-4">
        <strong class="d-block text-muted small">Erstellt am:</strong>
        <span><%= new Date(challenge.created_at).toLocaleDateString('de-DE') %></span>
      </div>
      <div class="col-md-4">
        <strong class="d-block text-muted small">Zuletzt bearbeitet:</strong>
        <span>
          <% if (challenge.updated_at) { %>
            <%= new Date(challenge.updated_at).toLocaleDateString('de-DE') %>
          <% } else { %>
            <span class="text-muted">Nie bearbeitet</span>
          <% } %>
        </span>
      </div>
      <div class="col-md-4">
        <strong class="d-block text-muted small">Challenge ID:</strong>
        <span><%= challenge.id %></span>
      </div>
    </div>
  </div>
</div>

<!-- Aktionen -->
<div class="d-flex justify-content-between mt-4">
  <div>
    <a href="/challenges/<%= challenge.id %>/edit" class="btn btn-primary">
      <i class="fas fa-edit me-1"></i> Challenge bearbeiten
    </a>
    <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
      <i class="fas fa-trash me-1"></i> Löschen
    </button>
  </div>
  <a href="/challenges" class="btn btn-secondary">
    <i class="fas fa-arrow-left me-1"></i> Zurück zur Übersicht
  </a>
</div>

<!-- Lösch-Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header custom-delete-header">
        <h5 class="modal-title">Challenge löschen</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Sind Sie sicher, dass Sie diese Challenge löschen möchten?</p>
        <div class="alert alert-warning">
          <strong>Achtung:</strong> Diese Aktion kann nicht rückgängig gemacht werden!
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
       <!-- Lösch-Formular anpassen -->
            <form action="/challenges/<%= challenge.id %>?_method=DELETE" method="POST" class="d-inline">
            <button type="submit" class="btn btn-danger">Ja, Challenge löschen</button>
            </form>
      </div>
    </div>
  </div>
</div>

<!-- <style>
.card-header h5 {
  font-size: 1.1rem;
}
.badge {
  font-size: 0.9rem;
  padding: 0.5em 0.75em;
}
</style> -->